#!/bin/sh

current=$(git branchname)
destiny:${1:-master}

# 1. Update destiny
git fetch
git checkout $destiny
[[ $? != 0 ]] || exit "failed to switch to $destiny"
git rebase

# 2. rebase PR branch
git checkout $current
git rebase -i $destiny

# 3. merge
git checkout $destiny
git merge --ff-only $current
git push

# 4. remove branch
git nuke $current $destiny
